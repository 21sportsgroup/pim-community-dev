{% extends 'StrixosWidgetBundle::layout.html.twig' %}

{% block title %}StrixOS - Edit Attribute Set{% endblock %}

{% block content_menu_more %}
    {{ parent() }}
    <li>
        <a href="{{ path('strixos_catalog_set_index') }}" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary" role="button">
            <span class="ui-button-icon-primary ui-icon ui-icon-fugue-ui-button-navigation-back"></span><span class="ui-button-text">Back to list</span>
        </a>
    </li>
{% endblock %}

{% block content %}

    {% form_theme form 'StrixosWidgetBundle:Form:fields.html.twig' %}
    <form action="{{ path('strixos_catalog_set_save') }}" method="post" {{ form_enctype(form) }}>
        {{ form_errors(form) }}
    
        <div class="form-panel ui-corner-all">
            <h2>General</h2>
            {{ form_row(form.id) }}
            {{ form_row(form.code) }}
        </div>

        {% if form.id.vars.value <= 0 %}
        <div class="form-panel ui-corner-all">
            <h2>Copy from attribute set</h2>
            {{ form_row(form.copyfromset) }}
        </div>
        {% endif %}


        {% if form.id.vars.value > 0 %}

            <div class="ui-corner-all">
                <h2>Set attributes</h2>
                <div id="tabs">
                    <!-- one tab by group -->
                    <ul>
                        {% for group in form.groups %}
                        <li><a href="#tabs-{{ group.id.vars.value }}">{{ group.code.vars.value }}</a> <span class="ui-icon ui-icon-close">Remove Tab</span></li>
                        {% endfor %}
                    </ul>
                    <!-- tabs content -->
                    {% for group in form.groups %}
                    <div id="tabs-{{ group.id.vars.value }}">
                        <ul class="connectedSortable">
                            {% for attribute in form.attributes %}
                                <li class="ui-state-default ui-corner-all" id="{{ attribute.id.vars.value }}">{{ attribute.code.vars.value }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                </div>
            </div>

        {% endif %}


<script>
$(function() {
    $( ".connectedSortable" ).sortable().disableSelection();

    var $tabs = $( "#tabs" ).tabs();

    var $tab_items = $( "ul:first li", $tabs ).droppable({
        accept: ".connectedSortable li",
        hoverClass: "ui-state-hover",
        drop: function( event, ui ) {
            var $item = $( this );
            var $list = $( $item.find( "a" ).attr( "href" ) )
                .find( ".connectedSortable" );

            ui.draggable.hide( "slow", function() {
                $tabs.tabs( "select", $tab_items.index( $item ) );
                $( this ).appendTo( $list ).show( "slow" );
            });
        }
    });
});
</script>

{% endblock %}