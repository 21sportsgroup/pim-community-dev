{% extends 'StrixosIcecatConnectorBundle::layout.html.twig' %}

{% block title %}StrixOS - Manage Icecat configuration{% endblock %}

{% block content %}

    {% form_theme form 'StrixosWidgetBundle:Form:fields.html.twig' %}
    <form action="{{ path('strixos_icecatconnector_config_save') }}" method="post" {{ form_enctype(form) }}>
        {{ form_errors(form) }}

        <div class="form-panel ui-corner-all">
                <h2>Options</h2>
                <div>
                    <ul class="options" data-prototype="{{ form_widget(form.configs.vars.prototype)|e }}" >
                        {% for config in form.configs %}
                            <li>{{ form_row(config.value) }}</li>
                        {% endfor %}
                    </ul>
                </div>
        </div>

        {{ form_widget(form._token) }}

        <input type="submit" value="Save" class="ui-button ui-widget ui-state-default ui-corner-all" role="button" aria-disabled="false">

    </form>

    <script type="text/javascript">
    // Get the div that holds the collection of options
    var collectionHolder = $('ul.options');
    
    // setup an "add an option" link
    var $addOptionLink = $('<a href="#" class="add_option_link">Add a config</a>');
    var $newLinkLi = $('<li></li>').append($addOptionLink);
    
    jQuery(document).ready(function() {
        // add a delete link to all of the existing option form li elements
        collectionHolder.find('li').each(function() {
            addOptionFormDeleteLink($(this));
        });
    
        // add the "add a option" anchor and li to the options ul
        collectionHolder.append($newLinkLi);
    
        $addOptionLink.on('click', function(e) {
            // prevent the link from creating a "#" on the URL
            e.preventDefault();
    
            // add a new tag form (see next code block)
            addOptionForm(collectionHolder, $newLinkLi);
        });
    });
    
    function addOptionForm(collectionHolder, $newLinkLi) {
        // Get the data-prototype we explained earlier
        var prototype = collectionHolder.attr('data-prototype');
    
        // Replace '__name__' in the prototype's HTML to
        // instead be a number based on the current collection's length.
        var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);
    
        // Display the form in the page in an li, before the "Add an option" link li
        var $newFormLi = $('<li></li>').append(newForm);
        $newLinkLi.before($newFormLi);
    
        // add a delete link to the new form
        addOptionFormDeleteLink($newFormLi);
    }
    
    function addOptionFormDeleteLink($optFormLi) {
        var $removeFormA = $('<a class="action-delete-inline" href="#">Delete ^</a>');

        $optFormLi.append($removeFormA);
    
        $removeFormA.on('click', function(e) {
            // prevent the link from creating a "#" on the URL
            e.preventDefault();
    
            // remove the li for the tag form
            $optFormLi.remove();
        });
    }
    
    </script>

{% endblock %}