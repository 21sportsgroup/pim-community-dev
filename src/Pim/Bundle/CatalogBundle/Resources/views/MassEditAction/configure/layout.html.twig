{% extends 'PimCatalogBundle:MassEditAction:layout.html.twig' %}

{% block content %}
    {% set title = 'pim_catalog.mass_edit_action.page_title'|trans %}
    {% set subtitle = 'pim_catalog.mass_edit_action.page_subtitle'|transchoice(productIds|length) %}
    {{ elements.page_header(title, null, subtitle) }}

    {{ parent() }}

    <form id="{{ form.vars.id }}" action="{{ path('pim_catalog_mass_edit_action_perform', { 'operationAlias': batchOperator.operationAlias, 'products': productIds }) }}" method="POST" class="form-horizontal">

        <div class="row">
            <div class="offset1 span12">
                <h3>{{ ('pim_catalog.mass_edit_action.' ~ batchOperator.operationAlias ~ '.label')|trans }}</h3>
                <div class="pull-right">
                    {% block formTitle %}{% endblock %}
                </div>
            </div>
        </div>

        <div class="row buffer-top">
            <div class="offset1 span12 mass-edit-form">
            {% block formContent %}
                {{ form_widget(form) }}
            {% endblock %}
            </div>
        </div>

        <div class="row offset1 buffer-top">
            <a href="#" class="btn cancel">Cancel</a>
            <a href="#" class="btn btn-primary confirm">Next</a>
        </div>

    </form>
{% endblock %}

{% block head_script_component %}
    {% set currentStep = 3 %}
    {{ parent() }}

    {% set action = path('pim_catalog_mass_edit_action_configure', { 'operationAlias': batchOperator.operationAlias, 'products': productIds }) %}
    <script type="text/javascript">
        $(function() {
            'use strict';

            var disableForm = function($form) {
                $form.find('input, textarea').each(function() {
                    $(this).attr('readonly', 'true');
                });
            };

            var enableForm = function($form) {
                $form.find('input, textarea').each(function() {
                    $(this).removeAttr('readonly');
                });
            };

            var $confirmLink;

            $('select.operation-param').change(function (event) {
                $('#{{ form.vars.id }}')
                    .attr('action', '{{ action|raw }}')
                    .submit();
            });

            /**
             * Confirmation
             */
            $('body').on('click', 'a.confirm', function(event) {
                event.preventDefault();

                $('.wizard').wizard({ currentStep: 4});
                disableForm($(this).parents('form').first());
                $confirmLink = $(this);
                $(this).replaceWith('<input type="submit" class="btn btn-primary confirm" value="Confirm"/>');
            });

            $('a.cancel').click(function(event) {
                event.preventDefault();

                $('.wizard').wizard({ currentStep: 3});
                enableForm($(this).parents('form').first());
                $('.confirm').replaceWith($confirmLink);
            });



        });
    </script>
{% endblock %}
