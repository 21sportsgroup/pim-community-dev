{% spaceless %}
{% set nested = true %}
[{% for category in categories %}
    {
        "attr": {"id":"node_{{ category.id }}"},
        "data": "{{ category.label|raw }} ({{ category|count_products(nested) }})",
        "state": "{{ category|state }}"
    }
    {% if not loop.last %},{% endif %}
{% endfor %}]
{% endspaceless %}