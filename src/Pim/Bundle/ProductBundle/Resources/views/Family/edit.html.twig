{% extends 'PimProductBundle:Family:index.html.twig' %}

{% block familyTab %}
{{ JSFV(form) }}
<form id="{{ form.vars.id }}" class="form-horizontal" action="{{ path('pim_product_family_edit', { id: family.id }) }}" method="POST">

    {% set title = 'Family'|trans ~ ' - ' ~ family.label %}
    {% set buttons %}
        {{ elements.submitBtn }}
        {{ elements.deleteLink(path('pim_product_family_remove', {'id': family.id}), 'Are you sure you want to remove the family %family%?'|trans({'%family%': family.label})) }}
    {% endset %}

    {{ elements.page_header(title, buttons) }}

    {{ elements.form_navbar(['Properties', 'Attributes', 'History']) }}

    <div class="tab-content">

        {{ elements.form_errors(form) }}

        <div class="tab-pane active" id="properties">
            {% set generalProperties %}
                {{ form_row(form.code) }}
                {{ form_row(form.attributeAsLabel) }}
            {% endset %}

            {{ elements.accordion({ 'General Properties': generalProperties, 'Locale values': form_row(form.label) }) }}
        </div>
        {{ form_row(form._token) }}
    </form>

        <div class="tab-pane" id="attributes">
            <div id="attribute-buttons">
                {% include 'PimProductBundle:ProductAttribute:_available-attributes-form.html.twig' with {
                    'form': attributesForm,
                    'action': path('pim_product_family_addproductattributes', {'id': family.id})
                } %}
            </div>
            <table class="table groups">
                <thead>
                    <th>{{ 'Label'|upper }}</th>
                    <th>&nbsp;</th>
                </thead>

                <tbody>
                    {% if family.attributes|length > 0 %}
                        {% set attributeGroup = family.attributes.first.group %}
                        <tr class="group">
                            <td colspan="2"><i class="fa-icon-collapse-alt"></i> {{ attributeGroup ? attributeGroup.name : 'Other'|trans }}</td>
                        </tr>
                        {% for attribute in family.attributes %}
                            {% if attribute.group != attributeGroup %}
                            </tbody>
                            <tbody>
                                <tr class="group">
                                    <td colspan="2"><i class="fa-icon-collapse-alt"></i> {{ attribute.group ? attribute.group.name : 'Other'|trans }}</td>
                                </tr>
                            {% endif %}
                            <tr>
                                <td>{{ attribute.label }}</td>
                                <td>
                                    <a href="{{ path('pim_product_family_removeproductattribute', {'familyId': family.id, 'attributeId': attribute.id}) }}"
                                        class="remove-attribute" data-dialog="confirm" data-method="DELETE" data-title="{{ 'Delete confirmation'|trans }}" data-message="{{ 'Are you sure you want to remove attribute %attribute%?'|trans({'%attribute%': attribute.label}) }}">
                                        <i class="icon-trash"></i>
                                    </a>
                                </td>
                            </tr>
                            {% set attributeGroup = attribute.group %}
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
        </div>

        <div class="tab-pane" id="history">
            <div id="history-grid"></div>
        </div>

    </div>
{% endblock %}

{% block head_script_component %}
    {{ parent() }}

    <script type="text/javascript">
        $(function() {
            'use strict';
            $('.group').click(function() {
                $(this).parent().find('tr:not(.group)').toggle();
                $(this).find('i').toggleClass('fa-icon-expand-alt fa-icon-collapse-alt');
            });
        });
    </script>
    {#
    {% include 'OroGridBundle:Include:javascript.html.twig' with {'datagridView': datagrid, 'selector': '#history-grid'} %}
    #}
{% endblock %}
