{% extends 'PimProductBundle::layout.html.twig' %}

{% set title = 'Groups overview'|trans %}

{% block content %}

    {% set currentGroup = group is defined ? group : null %}

    <div class="row-fluid has-resizable-sidebar">
        <div class="resizable-sidebar">
            <form id="pim_product_attributegroup_sort" action="{{ path('pim_product_attributegroup_sort') }}" method="POST">
            <ul id="entities-sortable">
                {% for group in groups %}
                    <li class="{{ group == currentGroup ? 'active' : '' }}">
                        <span class="handle">
                            <i class="icon-list"></i>
                            <input name="{{ group.id }}" type="hidden" value="{{ group.sortOrder }}">
                        </span>
                        <a href="{{ path('pim_product_attributegroup_edit', {'id': group.id}) }}">{{ group.name }}</a>
                    </li>
                {% endfor %}
                <li>
                    <a id="attributegroup-create" class="btn btn-small" href="{{ path('pim_product_attributegroup_create') }}">{{ 'New group'|trans }}</a>
                </li>
            </ul>
            </form>
        </div>
        <div id="form-tab" class="resizable-content">
            {% block groupTab %}
            <h3>{{ title }}</h3>
            {% endblock groupTab %}
        </div>
    </div>

    <script type="text/javascript">
        $(function() {
            $('#entities-sortable').sortable({
                handle: '.handle',
                containment: 'parent',
                tolerance: 'pointer',
                update: updateSortOrder
            });

            function updateSortOrder() {
                var num = 0;
                $('#entities-sortable').find('li').each(function() {
                    $(this).find('.handle input').val(num);
                    num++;
                });

                $.ajax({
                    url: '{{ path('pim_product_attributegroup_sort') }}',
                    type: 'POST',
                    data: $('#pim_product_attributegroup_sort').serialize()
                });
            }
        });
    </script>

{% endblock %}
