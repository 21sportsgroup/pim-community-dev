{% set title = form.vars.value.id ? 'Edit attribute'|trans : 'Add attribute'|trans %}
<form id="{{ form.vars.id }}" class="form-horizontal" action="{{ form.vars.value.id ?
    path('pim_product_productattribute_edit', { id: form.vars.value.id }) :
    path('pim_product_productattribute_create') }}" method="POST" class="form-register">
    <div class="row-fluid">
        <div class="form-row">
            <h3 class="pull-left">{{ title|trans }}</h3>
            <button class="btn btn-primary pull-right" type="submit">{{ 'Save'|trans }}</button>
            {% if form.vars.value.id %}
                <a class="btn pull-right" href="#" id="btn-delete-attribute">
                    {{ "Delete" | trans }}
                </a>
            {% endif %}
            <a class="pull-right return" href="{{ path('pim_product_productattribute_index') }}">
                {{ "Back to list" | trans }}
            </a>
        </div>
    </div>
    <div id="form-navbar" class="navbar navbar-static scrollspy-nav">
        <div class="navbar-inner">
            <div class="row-fluid">
                <ul class="nav">
                    <li class="active"><a href="#form-parameters">{{ 'Parameters'|trans }}</a></li>
                    <li><a href="#form-values">{{ 'Values'|trans }}</a></li>
                    <li><a href="#form-rules">{{ 'Rules'|trans }}</a></li>

                    {% if form.groups is defined %}
                    <li><a href="#scroll-groups">{{ 'Groups'|trans }}</a></li>
                    {% endif %}

                    {% if form.rolesCollection is defined %}
                    <li><a href="#scroll-roles">{{ 'Roles'|trans }}</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        {% if form.vars.errors|length %}
            <div class="alert alert-error">
                {{ form_errors(form) }}
            </div>
        {% endif %}
        <div data-spy="scroll" data-target="#form-navbar" data-offset="50" class="scrollspy row-fluid">
            <div id="form-parameters">
                <h3 class="scrollspy-title">{{ "Parameters"|trans }}</h3>
                <div id="accordion1" class="accordion">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data=parent="#accordion1" href="#collapseOne">
                                <i class="icon-collapse"></i>
                                {{ "General parameters"|trans }}
                            </a>
                        </div>
                        <div id="collapseOne" class="accordion-body in">
                            <div class="accordion-inner">
                                {{ form_row(form.code, { 'label': 'Name'|trans }) }}
                                {{ form_row(form.attributeType) }}

                                {{ form_row(form.scopable, { 'label': 'Scope'|trans }) }}

                                {{ form_row(form.translatable) }}

                                {{ form_row(form.unique, { 'label': 'Unique value'|trans }) }}

                                <div class="control-group">
                                    <label class="control-label" for="limitLocales">{{ 'Locale specific'|trans }}</label>
                                    <div class="controls">
                                        <div id="limitLocales-switch" class="switch switch-small" data-on-label="{{ 'Yes'|trans }}" data-off-label="{{ 'No'|trans }}">
                                            <input type="checkbox" name="limitLocales" />
                                        </div>
                                    </div>
                                </div>

                                <div class="control-group" style="display: none;">
                                    {{ form_label(form.availableLocales, null, { 'label_attr': {'class': 'control-label'} }) }}
                                    <div class="controls">
                                        {{ form_widget(form.availableLocales, {'attr' : { 'class': 'span4' }}) }}
                                    </div>
                                </div>

                                {% set optionalFields = ['dateType', 'dateMin', 'dateMax',
                                'negativeAllowed', 'decimalsAllowed', 'numberMin', 'numberMax',
                                'valueCreationAllowed', 'maxCharacters', 'wysiwygEnabled',
                                'metricFamily', 'defaultMetricUnit', 'allowedFileSources',
                                'maxFileSize', 'allowedFileExtensions', 'validationRule',
                                'validationRegexp', 'defaultValue', 'sortOrder'] %}

                                {% for field in optionalFields %}
                                    {% if form[field] is defined %}
                                        {{ form_row(form[field]) }}
                                    {% endif %}
                                {% endfor %}

                            </div>
                        </div>
                    </div>
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data=parent="#accordion1" href="#collapseTwo">
                                <i class="icon-collapse"></i>
                                {{ "Backend parameters"|trans }}
                            </a>
                        </div>
                        <div id="collapseTwo" class="accordion-body in">
                            <div class="accordion-inner">
                                <div class="control-group">
                                    {{ form_label(form.group, 'Attribute group'|trans, { 'label_attr': {'class': 'control-label'} }) }}
                                    <div class="controls">
                                        {{ form_widget(form.group, { 'attr': { 'class': 'span4', 'data-placeholder': 'Choose a group'|trans }}) }}
                                    </div>
                                </div>

                                {{ form_row(form.variant, { 'label': 'Variants behavior when edited'|trans }) }}

                                {% if form.searchable is defined %}
                                    {{ form_row(form.searchable) }}
                                {% endif %}

                                {{ form_row(form.useableAsGridColumn) }}

                                {{ form_row(form.useableAsGridFilter) }}

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="form-values">
                <h3 class="scrollspy-title">{{ "Values"|trans }}</h3>
                <div id="accordion2" class="accordion">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data=parent="#accordion2" href="#collapseThree">
                                <i class="icon-collapse"></i>
                                {{ "Label translations"|trans }}
                            </a>
                        </div>
                        <div id="collapseThree" class="accordion-body in">
                            <div class="accordion-inner">
                                {{ form_row(form.label) }}
                            </div>
                        </div>
                    </div>
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data=parent="#accordion2" href="#collapseFour">
                                <i class="icon-collapse"></i>
                                {{ "Description"|trans }}
                            </a>
                        </div>
                        <div id="collapseFour" class="accordion-body in">
                            <div class="accordion-inner">
                                <div class="control-group">
                                    {{ form_row(form.description) }}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if form.options is defined %}
                        {% form_theme form 'PimProductBundle:Form:simple_layout.html.twig' %}
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                <a class="accordion-toggle" data-toggle="collapse" data=parent="#accordion2" href="#collapseFive">
                                    <i class="icon-collapse"></i>
                                    {{ "Options"|trans }}
                                </a>
                            </div>
                            <div id="collapseFive" class="accordion-body in">
                                <div class="accordion-inner">
                                    <table id="sortable_options" class="table table-striped table-hover table-condensed options">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>{{ "Default value"|trans }}</th>
                                                {% for locale in locales %}
                                                    <th>{{ locale.code|trans }}</th>
                                                {% endfor %}
                                                <th>{{ "Default value"|trans }}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for option in form.options %}
                                                <tr class="att-option">
                                                    <td class="handle">
                                                        <i class="icon-list"></i>
                                                        {{ form_row(option.sort_order) }}
                                                    </td>
                                                    <td>
                                                        {{ form_row(option.defaultValue) }}
                                                    </td>
                                                    {% for i in 0..locales|length-1 %}
                                                        <td>
                                                            {% for value in option.optionValues %}
                                                                {% if value.locale.vars.value == locales[i].code %}
                                                                    {{ form_row(value.id) }}
                                                                    {{ form_row(value.value) }}
                                                                    {{ form_row(value.locale) }}
                                                                {% endif %}
                                                            {% endfor %}
                                                        </td>
                                                    {% endfor %}
                                                    {% if form.defaultValue is defined %}
                                                        <td>
                                                            <input type="radio" name="default_option" id="default_option_{{ option.vars.value.id }}" {% if option.vars.value.id == form.defaultValue.vars.value or option.vars.value.id in form.defaultValue.vars.value %} checked="checked"{% endif %}>
                                                        </td>
                                                    {% endif %}
                                                    {% if disabledLocales is not empty %}
                                                        <td style="display:none;">
                                                            {% for i in 0..disabledLocales|length-1 %}
                                                                {% for value in option.optionValues %}
                                                                    {% if value.locale.vars.value == disabledLocales[i].code %}
                                                                        {{ form_row(value.id) }}
                                                                        {{ form_row(value.locale) }}
                                                                        {{ form_row(value.value) }}
                                                                    {% endif %}
                                                                {% endfor %}
                                                            {% endfor %}
                                                        </td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        {% form_theme form 'PimUIBundle:Form:fields.html.twig' %}
                    {% endif %}
                </div>
            </div>

            <div id="form-rules">
                <h3 class="scrollspy-title">{{ "Rules"|trans }}</h3>
                <div id="accordion3" class="accordion">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data=parent="#accordion3" href="#collapseSix">
                                <i class="icon-collapse"></i>
                                {{ "Rules"|trans }}
                            </a>
                        </div>
                        <div id="collapseSix" class="accordion-body in">
                            <div class="accordion-inner">
                                {{ form_row(form.required) }}
                                {{ form_row(form.smart) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{ form_row(form.sortOrder) }}
        {{ form_row(form.id) }}
        {{ form_row(form._token) }}
    </div>
</form>
