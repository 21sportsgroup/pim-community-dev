{% extends 'PimProductBundle:ProductFamily:index.html.twig' %}

{% set title = 'Family'|trans %}

{% block familyTab %}
<form action="{{ form.vars.value.id ?
    path('pim_product_productfamily_edit', { id: form.vars.value.id }) :
    path('pim_product_productfamily_create') }}" method="POST" class="form-horizontal">
    {{ form_row(form._token) }}

    <div class="form-row">
        <h3>
            Family - {{ family }}
            <button type="submit" class="btn btn-primary pull-right">{{ ' Save'|trans }}</button>
            <a href="#" class="btn pull-right">{{ 'Delete'|trans }}</a>
        </h3>
    </div>

    <div id="form-navbar" class="navbar navbar-static scrollspy-nav">
        <div class="navbar-inner">
            <div class="row-fluid">
                <ul class="nav">
                    <li class="active"><a href="#properties" data-toggle="tab">{{ 'Properties' | trans }}</a></li>
                    <li><a href="#attributes" data-toggle="tab">{{ 'Attributes' | trans }}</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="tab-content">

        {% if form.vars.errors|length %}
        <div class="alert alert-error">
            {{ form_errors(form) }}
        </div>
        {% endif %}

        <div class="tab-pane active" id="properties">
            <div id="accordion1" class="accordion">
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapseOne">
                            <i class="icon-chevron-up"></i>
                            {{ "General Properties"|trans }}
                        </a>
                    </div>
                    <div id="collapseOne" class="accordion-body in">
                        <div class="accordion-inner">
                            {{ form_row(form.code) }}
                        </div>
                    </div>
                </div>
            </div>
            <div id="accordion2" class="accordion">
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
                            <i class="icon-chevron-up"></i>
                            {{ "Locale values"|trans }}
                        </a>
                    </div>
                    <div id="collapseTwo" class="accordion-body in">
                        <div class="accordion-inner">
                            {{ form_row(form.name) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
</form>

        <div class="tab-pane" id="attributes">
            {% include 'PimProductBundle:ProductAttribute:_available-attributes-form.html.twig' with {
                'form': attributesForm,
                'action': path('pim_product_productfamily_addproductattributes', {'id': family.id})
            } %}
            <table class="table groups">
                <thead>
                    <th>{{ 'Label'|upper }}</th>
                </thead>

                <tbody>

                    {% set attributeGroup = false %}
                    {% for attribute in family.attributes %}
                        {% if attribute.group != attributeGroup %}
                        </tbody>
                        <tbody>
                            <tr class="group">
                                <td><i class="icon-chevron-down"></i> {{ attribute.group ? attribute.group.name : 'Other'|trans }}</td>
                            </tr>
                        {% endif %}
                        <tr>
                            <td>{{ attribute.label }}</td>
                        </tr>
                        {% set attributeGroup = attribute.group %}
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
{% endblock %}

{% block javascript %}
    <script type="text/javascript">
        $(function() {
            $('.group').click(function(event) {
                event.preventDefault();
                $(this).parent().find('tr:not(.group)').toggle();
                $(this).find('i').toggleClass('icon-chevron-down').toggleClass('icon-chevron-up');
            });

            $('#pim_available_product_attributes_attributes').select2('destroy');
            $('#pim_available_product_attributes_attributes').css('width', 'auto');
            $('.dropdown-menu').find('form').click(function (event) {
                event.stopPropagation();
            });
        });
    </script>
{% endblock %}
