parameters:
    product_manager_class:            Pim\Bundle\ProductBundle\Manager\ProductManager
    product_entity_class:             Pim\Bundle\ProductBundle\Entity\Product

    product_attribute_class:          Pim\Bundle\ProductBundle\Entity\ProductAttribute
    product_attribute_value_class:    Pim\Bundle\ProductBundle\Entity\ProductValue

    product_attribute_type_class:     Pim\Bundle\ProductBundle\Form\Type\ProductAttributeType
    product_attribute_handler_class:  Pim\Bundle\ProductBundle\Form\Handler\ProductAttributeHandler

    attribute_group_entity_class:     Pim\Bundle\ProductBundle\Entity\AttributeGroup
    attribute_group_handler_class:    Pim\Bundle\ProductBundle\Form\Handler\AttributeGroupHandler
    attribute_group_type_class:       Pim\Bundle\ProductBundle\Form\Type\AttributeGroupType

    metric_attribute_validator_class: Pim\Bundle\ProductBundle\Validator\Constraints\ValidMetricAttributeValidator

services:
    # Managers
    product_manager:
        class:     %product_manager_class%
        arguments: [%product_entity_class%, %oro_flexibleentity.flexible_config%, @doctrine.orm.entity_manager, @event_dispatcher]
        tags:
            - { name: oro_flexibleentity_manager, entity: %product_entity_class%}

    # Form
    pim_product.form.attribute:
        class:           Symfony\Component\Form\Form
        factory_method:  createNamed
        factory_service: form.factory
        arguments: ["pim_product_attribute_form", "pim_product_attribute"]

    pim_product.form.attribute_group:
        class:           Symfony\Component\Form\Form
        factory_method:  createNamed
        factory_service: form.factory
        arguments: ["pim_attribute_group_form", "pim_attribute_group"]

    # Types
    pim_product.form.type.attribute:
        class: %product_attribute_type_class%
        tags:
            - { name: form.type, alias: pim_product_attribute }

    pim_product.form.type.attribute_group:
        class: %attribute_group_type_class%
        tags:
            - { name: form.type, alias: pim_attribute_group }

    # Handlers
    pim_product.form.handler.attribute:
        class: %product_attribute_handler_class%
        scope: request
        arguments: [@pim_product.form.attribute, @request, @doctrine.orm.entity_manager]

    pim_product.form.handler.attribute_group:
        class: %attribute_group_handler_class%
        scope: request
        arguments: [@pim_product.form.attribute_group, @request, @doctrine.orm.entity_manager]

    # Validators

    pim_product.form.validator.metric_attribute:
        class: %metric_attribute_validator_class%
        arguments: [%oro_measure.measures_config%]
        tags:
        - { name: validator.constraint_validator, alias: pim_metric_attribute_validator }

    # Media
    pim_media_manager:
        class: Pim\Bundle\ProductBundle\Manager\MediaManager
        arguments: [@knp_gaufrette.filesystem_map, "pim", %upload_dir%]

    # Product form value type
    form.type.pim_product_value:
        class: Pim\Bundle\ProductBundle\Form\Type\ProductValueType
        arguments: [@product_manager]
        tags:
            - { name: form.type, alias: pim_product_value }
